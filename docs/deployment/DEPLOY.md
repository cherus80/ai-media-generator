# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é AI Image Generator –Ω–∞ Beget VPS

–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è AI Image Generator –Ω–∞ VPS —Å–µ—Ä–≤–µ—Ä–µ Beget.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞)
3. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ssl-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤)
4. [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
5. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-nginx)
6. [–î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Docker](#–¥–µ–ø–ª–æ–π-—á–µ—Ä–µ–∑-docker)
7. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa Webhook](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—ékassa-webhook)
8. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
9. [Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ](#backup-–∏-–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ)
10. [Troubleshooting](#troubleshooting)

---

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≥–æ—Ç–æ–≤–æ:

- ‚úÖ VPS —Å–µ—Ä–≤–µ—Ä Beget —Å SSH –¥–æ—Å—Ç—É–ø–æ–º
- ‚úÖ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ Portainer —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ nginx —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä: `your-domain.com`)
- ‚úÖ API –∫–ª—é—á–∏:
  - OpenRouter API Key
  - –ÆKassa Shop ID –∏ Secret Key
  - JWT/SECRET –∫–ª—é—á–∏, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∞–Ω—Ç–∏–∞–±—É–∑–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

- **RAM**: –º–∏–Ω–∏–º—É–º 2GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 4GB)
- **Disk**: –º–∏–Ω–∏–º—É–º 10GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **CPU**: –º–∏–Ω–∏–º—É–º 2 cores
- **OS**: Ubuntu 20.04+ –∏–ª–∏ Debian 11+

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh root@your-server-ip
# –∏–ª–∏
ssh your-username@your-server-ip
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
sudo apt update
sudo apt upgrade -y
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤

```bash
sudo apt install -y curl git htop nano certbot python3-certbot-nginx
```

### 4. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

```bash
sudo mkdir -p /var/www/ai-image-bot
sudo chown -R $USER:$USER /var/www/ai-image-bot
cd /var/www/ai-image-bot
```

### 5. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ git
git clone https://github.com/your-repo/ai-image-bot.git .

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ SFTP/SCP
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: Let's Encrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è, –±–µ—Å–ø–ª–∞—Ç–Ω–æ)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ nginx –≤—Ä–µ–º–µ–Ω–Ω–æ
sudo systemctl stop nginx

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --standalone -d your-domain.com -d www.your-domain.com

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ nginx –æ–±—Ä–∞—Ç–Ω–æ
sudo systemctl start nginx
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ nginx

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è ACME challenge
sudo mkdir -p /var/www/certbot

# –ü–æ–ª—É—á–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certonly --webroot -w /var/www/certbot -d your-domain.com -d www.your-domain.com
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –î–æ–±–∞–≤—å—Ç–µ cron job –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 3:00)
0 3 * * 1 /usr/bin/certbot renew --quiet && systemctl reload nginx
```

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –°–æ–∑–¥–∞–Ω–∏–µ production .env —Ñ–∞–π–ª–æ–≤

#### Backend (.env.production)

```bash
cd /var/www/ai-image-bot
cp backend/.env.example backend/.env.production
nano backend/.env.production
```

**–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:**

```env
# Environment
ENVIRONMENT=production
DEBUG=False

# Backend
SECRET_KEY=<–°–ì–ï–ù–ï–†–ò–†–£–ô–¢–ï_–°–õ–£–ß–ê–ô–ù–´–ô_–ö–õ–Æ–ß_64_–°–ò–ú–í–û–õ–ê>
FRONTEND_URL=https://your-domain.com

# Database PostgreSQL
POSTGRES_USER=postgres
POSTGRES_PASSWORD=<–°–õ–û–ñ–ù–´–ô_–ü–ê–†–û–õ–¨>
POSTGRES_DB=ai_image_bot
POSTGRES_HOST=postgres
POSTGRES_PORT=5432

# Redis
REDIS_URL=redis://redis:6379/0

# External APIs
OPENROUTER_API_KEY=<–í–ê–®_OPENROUTER_–ö–õ–Æ–ß>
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
OPENROUTER_MODEL=anthropic/claude-3-haiku-20240307

# YooKassa
YUKASSA_SHOP_ID=<–í–ê–®_SHOP_ID>
YUKASSA_SECRET_KEY=<–í–ê–®_SECRET_KEY>
YUKASSA_WEBHOOK_SECRET=<–°–õ–£–ß–ê–ô–ù–´–ô_–ö–õ–Æ–ß_–î–õ–Ø_WEBHOOK>

# JWT
JWT_SECRET_KEY=<–°–ì–ï–ù–ï–†–ò–†–£–ô–¢–ï_–°–õ–£–ß–ê–ô–ù–´–ô_–ö–õ–Æ–ß_64_–°–ò–ú–í–û–õ–ê>
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440

# Admin
ADMIN_SECRET_KEY=<–°–ì–ï–ù–ï–†–ò–†–£–ô–¢–ï_–°–õ–£–ß–ê–ô–ù–´–ô_–ö–õ–Æ–ß_32_–°–ò–ú–í–û–õ–ê>

# File Storage
UPLOAD_DIR=/app/uploads
MAX_FILE_SIZE_MB=5
ALLOWED_EXTENSIONS=jpg,jpeg,png
PHOTO_RETENTION_HOURS=24
CHAT_HISTORY_RETENTION_DAYS=30

# Monetization
FREEMIUM_ACTIONS_PER_MONTH=10
FREEMIUM_WATERMARK_TEXT=AI Image Generator
NPD_TAX_RATE=0.04
YUKASSA_COMMISSION_RATE=0.028

# Rate Limiting
RATE_LIMIT_PER_MINUTE=10
REGISTRATION_LIMIT_PER_IP_PER_DAY=3
FREE_ACTIONS_PER_MONTH=10
REQUIRE_PHONE_VERIFICATION=true
ENABLE_DEVICE_FINGERPRINT=true

# Sentry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
SENTRY_DSN=
```

**–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–ª—é—á–µ–π:**

```bash
# –î–ª—è SECRET_KEY –∏ JWT_SECRET_KEY (64 —Å–∏–º–≤–æ–ª–∞)
openssl rand -hex 32

# –î–ª—è ADMIN_SECRET_KEY (32 —Å–∏–º–≤–æ–ª–∞)
openssl rand -hex 16

# –î–ª—è YUKASSA_WEBHOOK_SECRET
openssl rand -hex 24
```

#### Frontend (.env.production)

```bash
cp frontend/.env.example frontend/.env.production
nano frontend/.env.production
```

```env
VITE_API_BASE_URL=https://your-domain.com
VITE_APP_NAME=AI Image Generator
VITE_ENV=production
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ .env.production —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã
ls -la backend/.env.production
ls -la frontend/.env.production
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nginx

### 1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
sudo cp nginx/ai-image-bot.conf /etc/nginx/sites-available/ai-image-bot.conf
```

### 2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
sudo nano /etc/nginx/sites-available/ai-image-bot.conf
```

**–ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.com` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω** –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö:

```nginx
server_name your-domain.com www.your-domain.com;  # <- –ò–ó–ú–ï–ù–ò–¢–¨

# SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;  # <- –ò–ó–ú–ï–ù–ò–¢–¨
ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;  # <- –ò–ó–ú–ï–ù–ò–¢–¨
ssl_trusted_certificate /etc/letsencrypt/live/your-domain.com/chain.pem;  # <- –ò–ó–ú–ï–ù–ò–¢–¨
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–ª–∏–Ω–∫–∞

```bash
sudo ln -s /etc/nginx/sites-available/ai-image-bot.conf /etc/nginx/sites-enabled/
```

### 4. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
sudo rm /etc/nginx/sites-enabled/default
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx

```bash
sudo nginx -t
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:

```
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### 6. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ nginx

```bash
sudo systemctl reload nginx
```

---

## –î–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Docker

### 1. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–æ–≤

```bash
cd /var/www/ai-image-bot
./deploy.sh build
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–æ–≤
- –°–æ–±–µ—Ä—ë—Ç Docker –æ–±—Ä–∞–∑—ã –¥–ª—è backend, frontend, worker/beat
- –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-10 –º–∏–Ω—É—Ç

### 2. –ó–∞–ø—É—Å–∫ production –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
./deploy.sh start
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
- –ó–∞–ø—É—Å—Ç–∏—Ç PostgreSQL –∏ Redis
- –î–æ–∂–¥—ë—Ç—Å—è –∏—Ö –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (healthcheck)
- –ó–∞–ø—É—Å—Ç–∏—Ç Backend (FastAPI)
    - –ó–∞–ø—É—Å—Ç–∏—Ç Celery Worker –∏ Celery Beat
    - –ó–∞–ø—É—Å—Ç–∏—Ç Frontend (nginx + React)

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
./deploy.sh status
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã:

```
NAME                                  STATE    PORTS
ai_image_bot_backend_prod            Up       127.0.0.1:8000->8000/tcp
ai_image_bot_celery_beat_prod        Up
ai_image_bot_celery_worker_prod      Up
ai_image_bot_frontend_prod           Up       127.0.0.1:3000->80/tcp
ai_image_bot_postgres_prod           Up       127.0.0.1:5432->5432/tcp
ai_image_bot_redis_prod              Up       127.0.0.1:6379->6379/tcp
```

### 4. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

```bash
./deploy.sh migrate
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
./deploy.sh health
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏:

```
‚úì Backend: OK
‚úì Frontend: OK
‚úì PostgreSQL: OK
‚úì Redis: OK
```

### 6. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
./deploy.sh logs

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å
./deploy.sh logs backend
./deploy.sh logs celery_worker
```

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ÆKassa Webhook

### 1. –í–æ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ÆKassa

https://yookassa.ru/my

### 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞–≥–∞–∑–∏–Ω–∞

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üí HTTP-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### 3. –î–æ–±–∞–≤–∏—Ç—å webhook URL

```
https://your-domain.com/api/v1/payments/webhook
```

### 4. –í—ã–±—Ä–∞—Ç—å —Å–æ–±—ã—Ç–∏—è

–û—Ç–º–µ—Ç—å—Ç–µ:
- ‚úÖ `payment.succeeded` ‚Äî —É—Å–ø–µ—à–Ω—ã–π –ø–ª–∞—Ç—ë–∂
- ‚úÖ `payment.canceled` ‚Äî –æ—Ç–º–µ–Ω—ë–Ω–Ω—ã–π –ø–ª–∞—Ç—ë–∂

### 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å

–ÆKassa –Ω–∞—á–Ω—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø–ª–∞—Ç–µ–∂–∞—Ö –Ω–∞ –≤–∞—à —Å–µ—Ä–≤–µ—Ä.

### 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook

–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
./deploy.sh logs backend | grep "webhook"
```

–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —É—Å–ø–µ—à–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É webhook.

---

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./deploy.sh status

# Health check
./deploy.sh health

# –õ–æ–≥–∏ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
./deploy.sh logs

# –õ–æ–≥–∏ backend
./deploy.sh logs backend

# –õ–æ–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏)
./deploy.sh logs backend | grep ERROR

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats

# –ó–∞–Ω—è—Ç–æ–µ –º–µ—Å—Ç–æ
docker system df
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏

```bash
# nginx –ª–æ–≥–∏
sudo tail -f /var/log/nginx/ai-image-bot-access.log
sudo tail -f /var/log/nginx/ai-image-bot-error.log

# Docker –ª–æ–≥–∏
docker logs -f ai_image_bot_backend_prod
docker logs -f ai_image_bot_celery_worker_prod
```

### Portainer (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)

–û—Ç–∫—Ä–æ–π—Ç–µ Portainer –≤ –±—Ä–∞—É–∑–µ—Ä–µ:

```
https://your-server-ip:9443
```

–¢–∞–º –º–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:
- –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU/RAM
- –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ UI

---

## Backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å backup
./deploy.sh backup

# Backup —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ ./backups/backup_YYYYMMDD_HHMMSS.sql
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ backup (cron)

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å backup –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 4:00 —É—Ç—Ä–∞
0 4 * * * cd /var/www/ai-image-bot && ./deploy.sh backup
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
./deploy.sh stop

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ PostgreSQL
docker-compose -f docker-compose.prod.yml up -d postgres

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ backup
docker-compose -f docker-compose.prod.yml exec -T postgres psql -U postgres ai_image_bot < backups/backup_20250131_040000.sql

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
./deploy.sh start
```

### Backup –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

```bash
# –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ uploads
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz -C /var/lib/docker/volumes/ai_image_bot_backend_uploads/_data .

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å uploads
tar -xzf uploads_backup_20250131.tar.gz -C /var/lib/docker/volumes/ai_image_bot_backend_uploads/_data
```

---

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
./deploy.sh logs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª—ã
cat backend/.env.production
cat frontend/.env.production

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–æ—Ä—Ç–æ–≤
sudo netstat -tulpn | grep -E '8000|3000|5432|6379'

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –æ–±—Ä–∞–∑—ã
./deploy.sh build
./deploy.sh restart
```

### –ü—Ä–æ–±–ª–µ–º–∞: 502 Bad Gateway –≤ nginx

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
docker ps | grep backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend
./deploy.sh logs backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –æ—Ç–≤–µ—á–∞–µ—Ç
curl http://localhost:8000/health

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ nginx
sudo systemctl restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: Celery –∑–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ celery worker
./deploy.sh logs celery_worker

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
docker-compose -f docker-compose.prod.yml exec redis redis-cli ping

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ celery
docker-compose -f docker-compose.prod.yml restart celery_worker celery_beat
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å PostgreSQL
docker-compose -f docker-compose.prod.yml ps postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PostgreSQL
./deploy.sh logs postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
docker-compose -f docker-compose.prod.yml exec postgres pg_isready -U postgres

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ .env
grep POSTGRES_PASSWORD backend/.env.production
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot certificates

# –û–±–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot renew

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
sudo ls -la /etc/letsencrypt/live/your-domain.com/

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ nginx
sudo systemctl reload nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–Ω—è—Ç–æ–µ –º–µ—Å—Ç–æ
df -h

# –û—á–∏—Å—Ç–∏—Ç–µ Docker —Ä–µ—Å—É—Ä—Å—ã
./deploy.sh cleanup

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
docker image prune -a

# –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml logs --tail=0

# –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ backups
rm backups/backup_*.sql.old
```

---

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ git (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
cd /var/www/ai-image-bot

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥, –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
./deploy.sh update
```

### –°–ø–æ—Å–æ–± 2: –í—Ä—É—á–Ω—É—é

```bash
# 1. Pull –∏–∑–º–µ–Ω–µ–Ω–∏–π
git pull

# 2. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
./deploy.sh build

# 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
./deploy.sh stop

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
./deploy.sh migrate

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ–≤—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
./deploy.sh start

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ
./deploy.sh health
```

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **Frontend**: https://your-domain.com
- **Backend API**: https://your-domain.com/api/v1
- **Swagger UI**: https://your-domain.com/docs (–æ—Ç–∫–ª—é—á–∏—Ç–µ –≤ production!)
- **–ê–¥–º–∏–Ω–∫–∞**: https://your-domain.com/admin (—Ç—Ä–µ–±—É–µ—Ç ADMIN_SECRET_KEY)

---

## –ß–µ–∫-–ª–∏—Å—Ç –¥–µ–ø–ª–æ—è

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –≤ production —É–±–µ–¥–∏—Ç–µ—Å—å:

- [ ] –í—Å–µ .env.production —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ (`nginx -t`)
- [ ] Docker –æ–±—Ä–∞–∑—ã —Å–æ–±—Ä–∞–Ω—ã (`./deploy.sh build`)
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã (`./deploy.sh status`)
- [ ] Health check –ø—Ä–æ–π–¥–µ–Ω (`./deploy.sh health`)
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –≤—ã–ø–æ–ª–Ω–µ–Ω—ã (`./deploy.sh migrate`)
- [ ] –ÆKassa webhook –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω (cron job)
- [ ] –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏ (`./deploy.sh logs`)
- [ ] –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ä–∞–±–æ—Ç–∞–µ—Ç (https://your-domain.com)
- [ ] Swagger UI –æ—Ç–∫–ª—é—á–µ–Ω –≤ production (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ nginx.conf)
- [ ] ADMIN_SECRET_KEY –Ω–∞–¥—ë–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω

---

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í–∞—à AI Image Generator —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç –Ω–∞ production! üéâ**

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∏ –ø—Ä–æ–±–ª–µ–º–∞–º —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.
